openapi: 3.0.0
info:
  title: SteerSolo API
  description: |
    Comprehensive API documentation for the SteerSolo backend platform.
    This API handles authentication, e-commerce operations, payments via Paystack, and administrative management.
  version: 1.0.0
  contact:
    name: SteerSolo Engineering
    email: engineering@steersolo.com

servers:
  - url: http://localhost:5000/api/v1
    description: Development Server

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    # Generic Responses
    SuccessResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        message:
          type: string
          example: Operation successful
        data:
          type: object

    ErrorResponse:
      type: object
      properties:
        success:
          type: boolean
          example: false
        message:
          type: string
          example: An error occurred
        errors:
          type: array
          items:
            type: object
            properties:
              field:
                type: string
                example: email
              message:
                type: string
                example: Invalid email address

    # Auth Schemas
    User:
      type: object
      properties:
        id:
          type: string
          example: 60d5ecb8b392d211f4ce3571
        email:
          type: string
          format: email
          example: john.doe@example.com
        role:
          type: string
          enum: [CUSTOMER, ENTREPRENEUR, ADMIN]
          example: CUSTOMER
        profile:
          $ref: '#/components/schemas/Profile'

    Profile:
      type: object
      properties:
        firstName:
          type: string
          example: John
        lastName:
          type: string
          example: Doe
        phone:
          type: string
          example: "+2348012345678"
        avatar:
          type: string
          format: uri
          example: "https://example.com/avatar.jpg"

    # Shop Schemas
    Shop:
      type: object
      required:
        - name
        - slug
      properties:
        id:
          type: string
          example: 60d5ecb8b392d211f4ce3572
        name:
          type: string
          example: "Lagos Tech Gadgets"
        slug:
          type: string
          example: "lagos-tech-gadgets"
        description:
          type: string
          example: "The home of premium gadgets in Lagos."
        logo:
          type: string
          format: uri
          example: "https://cloudinary.com/steersolo/logo123.png"
        isActive:
          type: boolean
          example: true
        ownerId:
          type: string
          example: 60d5ecb8b392d211f4ce3571

    # Product Schemas
    Product:
      type: object
      required:
        - name
        - price
        - shopId
      properties:
        id:
          type: string
          example: 60d5ecb8b392d211f4ce3573
        name:
          type: string
          example: "Wireless Headphones"
        description:
          type: string
          example: "High-quality noise-canceling headphones."
        price:
          type: integer
          example: 25000
        stock:
          type: integer
          example: 50
        images:
          type: array
          items:
            type: object
            properties:
              url:
                type: string
                example: "https://cloudinary.com/steersolo/product1.jpg"
              position:
                type: integer
                example: 0

    # Order Schemas
    Order:
      type: object
      properties:
        id:
          type: string
          example: 60d5ecb8b392d211f4ce3574
        status:
          type: string
          enum: [PENDING, PROCESSING, SHIPPED, DELIVERED, CANCELLED]
          example: PENDING
        totalAmount:
          type: integer
          example: 50000
        customerName:
          type: string
          example: "Jane Smith"

paths:
  # --- AUTH ---
  /auth/signup:
    post:
      tags: [Auth]
      summary: Create a new account
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email, password, firstName, lastName]
              properties:
                email:
                  type: string
                  format: email
                  example: entrepreneur@steersolo.com
                password:
                  type: string
                  format: password
                  example: SecurePass123!
                firstName:
                  type: string
                  example: Victor
                lastName:
                  type: string
                  example: King
                role:
                  type: string
                  enum: [CUSTOMER, ENTREPRENEUR]
                  example: ENTREPRENEUR
      responses:
        '201':
          description: Registration successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /auth/login:
    post:
      tags: [Auth]
      summary: Login for token
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email, password]
              properties:
                email:
                  type: string
                  example: admin@steersolo.com
                password:
                  type: string
                  example: AdminSecret99#
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean, example: true }
                  data:
                    type: object
                    properties:
                      user: { $ref: '#/components/schemas/User' }
                      accessToken: { type: string, example: "eyJhbG..." }
                      refreshToken: { type: string, example: "eyJhbG..." }

  # --- SHOPS ---
  /shops:
    get:
      tags: [Shops]
      summary: List all active shops
      parameters:
        - name: page
          in: query
          schema: { type: integer, default: 1 }
        - name: limit
          in: query
          schema: { type: integer, default: 10 }
      responses:
        '200':
          description: List of shops
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean, example: true }
                  data:
                    type: array
                    items: { $ref: '#/components/schemas/Shop' }
    post:
      tags: [Shops]
      summary: Create a shop
      security: [{ bearerAuth: [] }]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [name, slug]
              properties:
                name: { type: string, example: "Mega Store" }
                slug: { type: string, example: "mega-store" }
                description: { type: string, example: "Best prices in West Africa" }
      responses:
        '201':
          description: Created
        '403':
          description: Forbidden (Only Entrepreneurs)

  /shops/{slug}:
    get:
      tags: [Shops]
      summary: Get shop details
      parameters:
        - name: slug
          in: path
          required: true
          schema: { type: string, example: "mega-store" }
      responses:
        '200':
          description: Shop data
          content:
            application/json:
              schema: { $ref: '#/components/schemas/Shop' }

  # --- PRODUCTS ---
  /products:
    get:
      tags: [Products]
      summary: Browse products
      parameters:
        - name: shopId
          in: query
          schema: { type: string, example: "60d5..." }
        - name: categoryId
          in: query
          schema: { type: string, example: "60d5..." }
        - name: search
          in: query
          schema: { type: string, example: "iphone" }
      responses:
        '200':
          description: List of products
    post:
      tags: [Products]
      summary: Create product
      security: [{ bearerAuth: [] }]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [name, price, shopId]
              properties:
                name: { type: string, example: "Bose QC35" }
                price: { type: integer, example: 150000 }
                shopId: { type: string, example: "60d5ecb8b39..." }
                stock: { type: integer, example: 10 }
      responses:
        '201':
          description: Product added

  # --- ORDERS ---
  /orders:
    post:
      tags: [Orders]
      summary: Place order
      security: [{ bearerAuth: [] }]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [shopId, items, customerName, customerEmail, deliveryAddress]
              properties:
                shopId: { type: string, example: "60d5..." }
                items:
                  type: array
                  items:
                    type: object
                    properties:
                      productId: { type: string, example: "60d5..." }
                      quantity: { type: integer, example: 2 }
                customerName: { type: string, example: "Victor" }
                customerEmail: { type: string, example: "vic@example.com" }
                customerPhone: { type: string, example: "08012345678" }
                deliveryAddress: { type: string, example: "123 Lekki, Lagos" }
      responses:
        '201':
          description: Order created

  # --- PAYMENTS ---
  /payments/initialize:
    post:
      tags: [Payments]
      summary: Start payment process
      security: [{ bearerAuth: [] }]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [orderId]
              properties:
                orderId: { type: string, example: "60d5ecb8b392d211f4ce3574" }
      responses:
        '200':
          description: Payment URL generated
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean, example: true }
                  data:
                    type: object
                    properties:
                      authorization_url: { type: string, example: "https://checkout.paystack.com/..." }
                      reference: { type: string, example: "SS_123456" }

  /payments/verify/{reference}:
    get:
      tags: [Payments]
      summary: Verify Paystack transaction
      security: [{ bearerAuth: [] }]
      parameters:
        - name: reference
          in: path
          required: true
          schema: { type: string, example: "SS_123456" }
      responses:
        '200':
          description: Payment verified

  # --- ADMIN ---
  /admin/analytics:
    get:
      tags: [Admin]
      summary: Platform analytics
      security: [{ bearerAuth: [] }]
      responses:
        '200':
          description: Stats JSON
        '403':
          description: Admin role required

  # --- HEALTH ---
  /health:
    get:
      tags: [General]
      summary: Health check
      responses:
        '200':
          description: Server status
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean, example: true }
                  message: { type: string, example: "SteerSolo API is running" }
